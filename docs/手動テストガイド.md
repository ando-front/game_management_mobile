# 手動テストガイド

## 前提条件
- 開発サーバーが起動していること（`npm run dev`）
- ブラウザで http://localhost:5173 にアクセス可能

---

## テスト1: 基本動作確認（5分）

### 1.1 初回起動
1. ブラウザで http://localhost:5173 を開く
2. **期待結果**: 子供用ホーム画面が表示される
3. **確認項目**:
   - [ ] 「残り時間: 0 分」が表示される
   - [ ] 「ゲームをはじめる」ボタンが**無効**（グレーアウト）
   - [ ] 「親モード →」ボタンが表示される

### 1.2 親モード入室
1. 「親モード →」ボタンをクリック
2. **期待結果**: PIN入力画面が表示される
3. デフォルトPIN「0000」を入力
   - 数字ボタン「0」を4回クリック
4. 「開く」ボタンをクリック
5. **期待結果**: 親管理画面に遷移
6. **確認項目**:
   - [ ] 親管理画面が表示される
   - [ ] 「+5分」「+10分」「+15分」ボタンが表示される
   - [ ] 「時間をリセット」ボタンが表示される
   - [ ] 「PIN設定を変更」ボタンが表示される
   - [ ] 「利用履歴」セクションが表示される

### 1.3 時間付与
1. 「+5分」ボタンをクリック
2. **期待結果**: トースト通知「+5分 付与しました」が表示される
3. 3秒後にトーストが自動消去されることを確認
4. **確認項目**:
   - [ ] トースト通知が表示される
   - [ ] トーストが3秒で消える

### 1.4 子供モードへ戻る
1. 「子供モードへ →」ボタンをクリック
2. **期待結果**: 子供用ホーム画面に戻る
3. **確認項目**:
   - [ ] 「残り時間: 5 分」が表示される
   - [ ] 「ゲームをはじめる」ボタンが**有効**（青色）

---

## テスト2: ゲーム実行（3分）

### 2.1 ゲーム開始
1. 子供用ホーム画面で「ゲームをはじめる」ボタンをクリック
2. **期待結果**: 画面が「ゲーム中」に変わる
3. **確認項目**:
   - [ ] 「ゲーム中」の文字が表示される
   - [ ] 経過時間が「00:00」から始まる
   - [ ] 1秒ごとに経過時間が更新される（00:01, 00:02...）
   - [ ] 「長押しで終了する」ボタンが表示される
   - [ ] 残り時間が表示される

### 2.2 ゲーム終了（長押し）
1. 30秒程度待つ（経過時間が00:30くらいまで）
2. 「長押しで終了する」ボタンを**長押し**（約1秒）
3. **期待結果**: 確認ダイアログが表示される
4. ダイアログで「終了する」をクリック
5. **期待結果**: ゲームが終了し、子供用ホーム画面に戻る
6. **確認項目**:
   - [ ] 残り時間が減少している（約4分）
   - [ ] 「ゲームをはじめる」ボタンが再び有効

### 2.3 短時間タップ（誤操作防止）
1. 再度「ゲームをはじめる」ボタンをクリック
2. ゲーム中画面で「長押しで終了する」ボタンを**短くタップ**（0.5秒未満）
3. **期待結果**: 何も起こらない（ダイアログが表示されない）
4. **確認項目**:
   - [ ] 短いタップでは終了しない
   - [ ] ゲームが継続している

### 2.4 キャンセル動作
1. 「長押しで終了する」ボタンを長押し
2. ダイアログで「キャンセル」をクリック
3. **期待結果**: ゲームが継続する
4. **確認項目**:
   - [ ] ゲーム中画面のまま
   - [ ] 経過時間が継続してカウントアップ

---

## テスト3: データ永続化（2分）

### 3.1 データ保存確認
1. ゲームを終了し、子供用ホーム画面に戻る
2. ブラウザのタブを閉じる
3. 再度 http://localhost:5173 を開く
4. **期待結果**: 残り時間が保持されている
5. **確認項目**:
   - [ ] 閉じる前の残り時間が復元される
   - [ ] アプリの状態が保持されている

### 3.2 IndexedDB確認
1. F12キーを押して開発者ツールを開く
2. 「Application」タブをクリック
3. 左サイドバーで「IndexedDB」→「GameTimeDB」を展開
4. **確認項目**:
   - [ ] `appState` テーブルが存在する
   - [ ] `usageLogs` テーブルが存在する
   - [ ] `appState` テーブルに1件のデータがある
5. `appState` テーブルをクリック
6. **確認項目**:
   - [ ] `remainingMinutes` の値が正しい
   - [ ] `pin` の値が存在する
   - [ ] `version` が 1

---

## テスト4: PIN認証とセキュリティ（5分）

### 4.1 PIN誤入力
1. 子供用ホーム画面で「親モード →」をクリック
2. 誤ったPIN「1234」を入力して「開く」をクリック
3. **期待結果**: エラーメッセージ表示
4. **確認項目**:
   - [ ] 「PINが正しくありません（1/5回）」と表示される
   - [ ] PIN入力画面のまま

### 4.2 PIN失敗カウント
1. 再度誤ったPIN「1111」を入力
2. **期待結果**: 「PINが正しくありません（2/5回）」
3. さらに3回誤入力（合計5回）
4. **期待結果**: ロックアウト
5. **確認項目**:
   - [ ] 「5回失敗しました。30秒後に再試行してください」と表示される
   - [ ] 入力が無効化される

### 4.3 ロック解除待機
1. 30秒待つ
2. **期待結果**: 自動的にロックが解除される
3. 正しいPIN「0000」を入力
4. **期待結果**: 親管理画面に遷移
5. **確認項目**:
   - [ ] 30秒後に再入力可能になる
   - [ ] 正しいPINで入室できる
   - [ ] 試行回数がリセットされている

### 4.4 試行回数リセット
1. 親管理画面で「子供モードへ →」をクリック
2. 再度「親モード →」をクリック
3. 誤ったPINを1回入力
4. 「キャンセル」ボタンをクリック
5. 再度「親モード →」をクリック
6. **期待結果**: 試行回数がリセットされている
7. **確認項目**:
   - [ ] キャンセル後は試行回数がリセット
   - [ ] 新たに5回まで試行可能

---

## テスト5: PIN変更（3分）

### 5.1 PIN変更実行
1. 親管理画面で「PIN設定を変更」ボタンをクリック
2. **期待結果**: PIN変更ダイアログが表示される
3. 各フィールドに以下を入力:
   - 現在のPIN: `0000`
   - 新しいPIN: `1234`
   - 確認PIN: `1234`
4. 「変更する」ボタンをクリック
5. **期待結果**: トースト「PINを変更しました」
6. **確認項目**:
   - [ ] トースト通知が表示される
   - [ ] ダイアログが閉じる

### 5.2 新PINで入室確認
1. 「子供モードへ →」をクリック
2. 「親モード →」をクリック
3. 旧PIN「0000」を入力
4. **期待結果**: エラー「PINが正しくありません」
5. 新PIN「1234」を入力
6. **期待結果**: 親管理画面に遷移
7. **確認項目**:
   - [ ] 旧PINでは入室不可
   - [ ] 新PINで入室可能

### 5.3 PIN変更のバリデーション
1. 親管理画面で「PIN設定を変更」をクリック
2. 各フィールドに以下を入力:
   - 現在のPIN: `1234`
   - 新しいPIN: `5678`
   - 確認PIN: `5679`（異なる値）
3. 「変更する」ボタンをクリック
4. **期待結果**: エラー「新しいPINが一致しません」
5. **確認項目**:
   - [ ] 確認PINが一致しない場合はエラー
   - [ ] PINが変更されない

---

## テスト6: 利用履歴とデータ管理（5分）

### 6.1 履歴表示
1. 親管理画面の「利用履歴」セクションを確認
2. **期待結果**: 最新10件の履歴が表示される
3. **確認項目**:
   - [ ] 時間付与の履歴が緑色で表示（例: +5分）
   - [ ] ゲーム消費の履歴が赤色で表示（例: -1分）
   - [ ] 日時が正しく表示される
   - [ ] 新しい履歴が上に表示される

### 6.2 JSONエクスポート
1. 「データをエクスポート」ボタンをクリック
2. **期待結果**: JSONファイルがダウンロードされる
3. ファイル名を確認
4. **確認項目**:
   - [ ] `game-time-backup_YYYY-MM-DD.json` 形式
   - [ ] 今日の日付が含まれる
   - [ ] ファイルサイズが0バイトより大きい

### 6.3 エクスポートファイルの内容確認
1. ダウンロードしたJSONファイルをテキストエディタで開く
2. **確認項目**:
   - [ ] `appState` キーが存在
   - [ ] `usageLogs` キーが存在
   - [ ] `remainingMinutes` の値が正しい
   - [ ] `pin` の値が含まれる（暗号化されていないので注意）

### 6.4 データインポート（オプション）
1. 親管理画面で「データをインポート」の「ファイルを選択」をクリック
2. 先ほどエクスポートしたJSONファイルを選択
3. **期待結果**: トースト「データをインポートしました」
4. **確認項目**:
   - [ ] トースト通知が表示される
   - [ ] エラーが発生しない

---

## テスト7: エッジケース（5分）

### 7.1 残り時間ゼロでのゲーム開始
1. 親管理画面で「時間をリセット」をクリック
2. 確認ダイアログで「リセット」をクリック
3. 子供モードに戻る
4. **期待結果**: 残り時間が0分
5. **確認項目**:
   - [ ] 「ゲームをはじめる」ボタンが無効（グレーアウト）
   - [ ] クリックしても何も起こらない

### 7.2 時間切れ自動終了
1. 親管理画面で「+1分」を手動で付与（カスタム実装が必要な場合は+5分で代用）
2. 子供モードでゲームを開始
3. 1分経過するまで待機
4. **期待結果**: 自動的にゲームが終了
5. **確認項目**:
   - [ ] 残り時間が0分になる
   - [ ] ゲームが自動終了する
   - [ ] 「ゲームをはじめる」ボタンが無効になる

### 7.3 長時間セッション（最大2時間制限）
1. この項目は実際にテストするには時間がかかりすぎるため、コードレビューで確認:
   - `src/stores/appStore.ts` の `tick` 関数
   - `MAX_SESSION_MINUTES` が120に設定されていることを確認
2. **確認項目**:
   - [ ] コード上で2時間制限が実装されている

### 7.4 ページVisibility（バックグラウンド時の自動保存）
1. ゲーム中にブラウザタブを切り替える
2. 別のタブに移動
3. 元のタブに戻る
4. **期待結果**: データが自動保存されている
5. **確認項目**:
   - [ ] タブ切り替え後も経過時間が正しい
   - [ ] データが保存されている（F12 → Console でエラーがないことを確認）

---

## テスト8: レスポンシブ・タッチUI（iPad想定）

### 8.1 タッチターゲットサイズ
1. 開発者ツール（F12）でデバイスツールバーを開く（Ctrl+Shift+M）
2. iPad Pro (12.9-inch) を選択
3. **確認項目**:
   - [ ] すべてのボタンが44px以上のタッチターゲット
   - [ ] ボタンが指で押しやすい
   - [ ] テキストが読みやすい

### 8.2 スクロール制御
1. iPad表示モードで画面を上下にスワイプ
2. **期待結果**: スクロールバウンスが発生しない
3. **確認項目**:
   - [ ] 固定レイアウトが維持される
   - [ ] 不要なスクロールが発生しない

### 8.3 タップハイライト
1. iPad表示モードでボタンをタップ
2. **確認項目**:
   - [ ] 青い選択ハイライトが表示されない
   - [ ] タップ時の視覚フィードバックがボタンスタイルのみ

---

## テスト完了チェックリスト

すべてのテストが完了したら、以下を確認してください：

- [ ] テスト1: 基本動作確認 ✅
- [ ] テスト2: ゲーム実行 ✅
- [ ] テスト3: データ永続化 ✅
- [ ] テスト4: PIN認証とセキュリティ ✅
- [ ] テスト5: PIN変更 ✅
- [ ] テスト6: 利用履歴とデータ管理 ✅
- [ ] テスト7: エッジケース ✅
- [ ] テスト8: レスポンシブ・タッチUI ✅

## バグ報告テンプレート

もしバグを発見した場合は、以下の形式で記録してください：

```
【バグ番号】: #001
【発生箇所】: 画面名 / コンポーネント名
【再現手順】:
1. 〜をクリック
2. 〜を入力
3. 〜を確認

【期待される動作】:
〜が表示される / 〜が実行される

【実際の動作】:
〜が表示されない / エラーが発生する

【コンソールエラー】:
（F12 → Console のエラーメッセージをコピー）

【ブラウザ情報】:
- ブラウザ: Chrome 120.0.0.0 / Safari 17.0
- OS: macOS Sonoma 14.0 / iOS 17.0
- デバイス: MacBook Pro / iPad Pro 12.9"
```

---

## 次のステップ

すべてのテストが成功したら：

1. **アイコンPNG生成**: `public/ICON_README.md` の手順に従う
2. **本番ビルド**: `npm run build`
3. **デプロイ**: Netlify / Vercel / Cloudflare Pages
4. **iPad実機テスト**: HTTPS環境でPWA機能をテスト

テストお疲れ様でした！🎉
