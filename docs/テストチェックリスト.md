# テストチェックリスト

## 基本機能テスト

### 1. 子供用画面 - ゲーム開始/終了

#### テスト1-1: 基本的なゲーム開始/終了
- [ ] ページを開くと「残り時間: 0 分」と表示される
- [ ] 親モードで時間を付与する（+15分）
- [ ] 子供モードに戻り、「ゲームをはじめる」ボタンが表示される
- [ ] ボタンをクリックするとゲームが開始し、経過時間が表示される
- [ ] 「長押しで終了する」ボタンを長押し（0.5〜1秒）
- [ ] 確認ダイアログが表示される
- [ ] 「終了する」をクリックすると残り時間が減少する

**期待結果**: 15分付与→10秒経過→終了で、残り時間が約15分になる

#### テスト1-2: 時間切れ時の動作
- [ ] 残り時間を0分にする（親モード→リセット）
- [ ] 「ゲームをはじめる」ボタンが無効化（グレーアウト）される
- [ ] 「残り時間がありません」「親に相談してください」が表示される

**期待結果**: ボタンが無効化され、適切なメッセージが表示される

#### テスト1-3: 長時間セッションの自動終了
- [ ] 親モードで150分付与する（+15分を10回）
- [ ] ゲームを開始する
- [ ] ブラウザの開発者ツールでタイムスタンプを2時間以上前に設定するか、
     実際に2時間待つ（現実的でない場合はコードレビューで確認）

**期待結果**: 最大120分で自動終了し、警告メッセージが表示される

---

### 2. 親モード - PIN入力

#### テスト2-1: 正しいPINでログイン
- [ ] 子供画面で「親モード」ボタンをクリック
- [ ] PIN入力画面が表示される
- [ ] デフォルトPIN「0000」を入力
- [ ] 「開く」ボタンをクリック
- [ ] 親管理画面に遷移する

**期待結果**: PIN入力成功で親管理画面が表示される

#### テスト2-2: 誤ったPINでの失敗
- [ ] PIN入力画面で「1234」など誤ったPINを入力
- [ ] 「PINが正しくありません（1/5回）」と表示される
- [ ] もう一度誤ったPINを入力
- [ ] 「PINが正しくありません（2/5回）」と表示される

**期待結果**: 試行回数がカウントされ、エラーメッセージが表示される

#### テスト2-3: 5回失敗でロック
- [ ] 誤ったPINを5回連続で入力
- [ ] 「5回失敗しました。30秒後に再試行してください」と表示される
- [ ] 正しいPINを入力しようとしても「XX秒後に再試行してください」と表示される
- [ ] 30秒待つ
- [ ] 正しいPIN「0000」を入力すると成功する

**期待結果**: 5回失敗でロック、30秒後に解除される

#### テスト2-4: キャンセル時のリセット
- [ ] 誤ったPINを3回入力
- [ ] 「キャンセル」ボタンをクリック
- [ ] 再度「親モード」ボタンをクリック
- [ ] 試行回数がリセットされている（エラーメッセージに回数が表示されない）

**期待結果**: キャンセル時に試行回数がリセットされる

---

### 3. 親モード - 時間管理

#### テスト3-1: 時間付与
- [ ] 親管理画面で「+5分」ボタンをクリック
- [ ] トースト通知「+5分 付与しました」が表示される
- [ ] 残り時間が5分増加する
- [ ] 「+10分」「+15分」ボタンでも同様に動作する

**期待結果**: 各プリセットボタンで正しく時間が付与される

#### テスト3-2: 時間リセット
- [ ] 親管理画面で「時間をリセット」ボタンをクリック
- [ ] 確認ダイアログが表示される
- [ ] 「リセット」ボタンをクリック
- [ ] 残り時間が0分になる
- [ ] トースト通知「時間をリセットしました」が表示される

**期待結果**: 確認後にリセットされ、通知が表示される

---

### 4. 追加機能 - PIN変更

#### テスト4-1: PIN変更の成功
- [ ] 親管理画面で「PIN変更」ボタンをクリック
- [ ] ダイアログが表示される
- [ ] 現在のPIN「0000」を入力
- [ ] 新しいPIN「1234」を入力
- [ ] 確認PIN「1234」を入力
- [ ] 「変更する」ボタンをクリック
- [ ] トースト通知「PINを変更しました」が表示される
- [ ] 子供モードに戻り、親モードに再度入る
- [ ] 新しいPIN「1234」で入室できる

**期待結果**: PINが正しく変更される

#### テスト4-2: PIN変更の失敗ケース
- [ ] 現在のPINが間違っている場合のエラー
- [ ] 新しいPINが4桁でない場合のエラー
- [ ] 確認PINが一致しない場合のエラー

**期待結果**: 適切なエラーメッセージが表示される

---

### 5. 追加機能 - 利用履歴とバックアップ

#### テスト5-1: 利用履歴の表示
- [ ] 親管理画面で「データ管理」ボタンをクリック
- [ ] ダイアログに利用履歴が表示される
- [ ] 時間付与（緑色、+）と消費（赤色、-）が色分けされている
- [ ] 日時が正しく表示される

**期待結果**: 履歴が正しく表示され、色分けされている

#### テスト5-2: JSONエクスポート
- [ ] データ管理ダイアログで「JSONファイルで保存」ボタンをクリック
- [ ] ファイルダウンロードが開始される
- [ ] ファイル名が `game-time-backup_YYYY-MM-DD.json` 形式である

**期待結果**: JSONファイルがダウンロードされる

#### テスト5-3: JSONインポート
- [ ] エクスポートしたJSONファイルを保存
- [ ] 親管理画面でデータを変更する（時間を追加など）
- [ ] 「JSONファイルから読込」ボタンをクリック
- [ ] 保存したJSONファイルを選択
- [ ] データが復元される
- [ ] トースト通知「データを復元しました」が表示される

**期待結果**: データが正しく復元される

---

## データ永続化テスト

### 6. ブラウザ再起動時の復元

#### テスト6-1: 待機状態での復元
- [ ] 残り時間を30分にする
- [ ] ブラウザを閉じる
- [ ] ブラウザを再度開く
- [ ] 残り時間が30分のまま復元される

**期待結果**: 状態が正しく復元される

#### テスト6-2: ゲーム実行中の復元
- [ ] ゲームを開始する
- [ ] 10秒待つ
- [ ] ブラウザを閉じる
- [ ] ブラウザを再度開く
- [ ] ゲーム実行中の状態が復元される
- [ ] 経過時間が正しく表示される（10秒以上）

**期待結果**: 実行中の状態が復元され、経過時間が正しく計算される

#### テスト6-3: バックグラウンド移行時の保存
- [ ] ゲームを開始する
- [ ] ブラウザタブを切り替える（バックグラウンド）
- [ ] 開発者ツールでIndexedDBを確認
- [ ] `startTimestamp` が保存されている

**期待結果**: visibilitychangeイベントで自動保存される

---

## iPad Safari 固有機能テスト

### 7. タッチ操作（iPadで確認）

#### テスト7-1: ボタンのタップ領域
- [ ] 各ボタンがタップしやすい（指でタップして反応する）
- [ ] ボタンの最小サイズが44×44px以上である
- [ ] 誤タップが発生しない程度の余白がある

**期待結果**: タップ操作が快適

#### テスト7-2: 長押し操作
- [ ] 「長押しで終了する」ボタンを0.5秒以上長押し
- [ ] 確認ダイアログが表示される
- [ ] 短いタップでは反応しない

**期待結果**: 長押しが正しく検出される

#### テスト7-3: スクロールバウンス
- [ ] 画面をスワイプしてもバウンスしない
- [ ] オーバースクロール（引っ張り更新）が発生しない

**期待結果**: スクロールが制御されている

---

### 8. PWA機能（iPadで確認）

#### テスト8-1: ホーム画面への追加
- [ ] Safari で共有ボタン→「ホーム画面に追加」
- [ ] アプリがホーム画面に追加される
- [ ] アイコンが表示される（SVGまたはPNG）

**期待結果**: PWAとしてインストールできる

#### テスト8-2: スタンドアロン起動
- [ ] ホーム画面のアイコンからアプリを起動
- [ ] アドレスバーが表示されない（フルスクリーン）
- [ ] アプリが正常に動作する

**期待結果**: スタンドアロンアプリとして動作する

#### テスト8-3: オフライン動作
- [ ] ネットワークを切断する（機内モード）
- [ ] アプリを起動する
- [ ] 基本機能が動作する

**期待結果**: オフラインで動作する

---

## エラーケーステスト

### 9. エッジケース

#### テスト9-1: 残り時間マイナス
- [ ] 残り時間5分の状態でゲームを開始
- [ ] 10分間実行する（現実的でない場合はコードレビュー）
- [ ] 終了時に残り時間が0分になる（マイナスにならない）

**期待結果**: 残り時間が0未満にならない

#### テスト9-2: 大きな時間値
- [ ] +15分を50回クリック（750分）
- [ ] 正しく表示される（「12時間30分」など）

**期待結果**: 大きな値でも正しく動作する

#### テスト9-3: 無効なJSONインポート
- [ ] 空のJSONファイルをインポート
- [ ] エラーメッセージ「データ形式が正しくありません」が表示される
- [ ] 現在のデータが保持される

**期待結果**: 無効なデータを拒否し、現在のデータを保護する

---

## 受け入れ基準（詳細設計書 セクション18）

### 基本機能
- [ ] 子画面で「ゲームをはじめる」→10秒待機→長押しで「終了」→残り時間が正しく減少する
- [ ] 親モードでPIN入力後、時間付与（+5/+10/+15）が動作し、トースト通知が表示される
- [ ] リセットボタンで確認ダイアログが表示され、確定すると0分になる
- [ ] 残り0分の状態では「ゲームをはじめる」ボタンが無効化され、理由が表示される

### 追加機能
- [ ] PIN変更画面で正しくPINが変更できる
- [ ] 利用履歴に付与・消費の履歴が表示される
- [ ] PIN入力を5回失敗すると30秒ロックされる
- [ ] ロック中は残り時間が表示される

### データ永続化
- [ ] Safari ブラウザを閉じて再度開いても状態が復元される
- [ ] ゲーム実行中にアプリを再起動しても、経過時間が正しく精算される
- [ ] JSONエクスポート→インポートでデータが正しく復元される

### PWA（iPad Safari）
- [ ] iPad Safari でホーム画面に追加でき、スタンドアロンアプリとして起動する
- [ ] オフライン状態でもアプリが動作する
- [ ] ホーム画面アイコンが正しく表示される

### タッチ操作
- [ ] 大きなボタンがタップしやすい（画面幅の60〜80%）
- [ ] 長押し終了が正しく動作する（誤タップ防止）
- [ ] スクロールバウンスが発生しない

### エラーハンドリング
- [ ] PIN 入力失敗時にエラー表示される
- [ ] 120分超過時に自動終了し、警告が表示される
- [ ] データインポート時のバリデーションが動作する

---

## バグ発見時の対応

バグを発見した場合は、以下の情報を記録してください：

1. **再現手順**: どのような操作でバグが発生したか
2. **期待される動作**: 本来どうあるべきか
3. **実際の動作**: 実際に何が起こったか
4. **環境**: ブラウザ、デバイス、OS
5. **スクリーンショット**: 可能であれば画面キャプチャ

---

## 次のステップ

すべてのテストが完了したら：

1. バグがあれば修正
2. アイコンPNG画像の生成（まだの場合）
3. 本番環境へのデプロイ準備
4. ユーザーテスト（実際の家庭での試用）

お疲れさまでした！
